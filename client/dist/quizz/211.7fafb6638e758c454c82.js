(self.webpackChunkquizz=self.webpackChunkquizz||[]).push([[211],{8211:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ThemesModule:()=>ne});var n=i(5806),r=i(665),s=i(8002),o=i(5435),c=i(639),a=i(1320),d=i(7764),l=i(8747),h=i(362),p=i(8462),u=i(568),m=i(8583);const g=["*"];let f=(()=>{class e{constructor(e,t){this.controlContainer=e,this.alert=t,this.controlName="",this.width=0,this.multiple=!1,this.multiMax=void 0,this.labelValue="Ajouter des images",this.filesAddText="Fichier(s) Ajout\xe9(s)",this.style={}}ngOnInit(){this.parentForm=this.controlContainer.control,this.parentHandler()}ngOnChanges(e){this.style={width:this.width+"px"}}parentHandler(){this.parentForm.valueChanges.pipe((0,s.U)(e=>e[this.controlName])).subscribe(e=>{e&&(this.labelValue=e.length>0?this.filesAddText:this.labelValue)})}onChange(e){if(this.multiMax&&e.target.files.length+this.parentForm.value[this.controlName].length>this.multiMax)return this.alert.message=`Vous essayez de rajouter ${e.target.files.length-(this.multiMax-this.parentForm.value[this.controlName].length)} photos en trop`,void this.alert.switchAlert();e.target.files&&e.target.files.length>0&&this.parentForm.patchValue(this.multiple?{[this.controlName]:[...this.parentForm.value[this.controlName],...e.target.files]}:{[this.controlName]:e.target.files})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.gN),c.Y36(a.c))},e.\u0275cmp=c.Xpm({type:e,selectors:[["reg-file"]],inputs:{parentForm:"parentForm",controlName:"controlName",width:"width",multiple:"multiple",multiMax:"multiMax",labelValue:"labelValue",filesAddText:"filesAddText"},features:[c.TTD],ngContentSelectors:g,decls:5,vars:6,consts:[[1,"regFile",3,"formGroup"],[1,"regFile_label",3,"ngStyle"],["type","file",1,"regFile_noInput",3,"multiple","change"]],template:function(e,t){1&e&&(c.F$t(),c.TgZ(0,"div",0),c.TgZ(1,"label",1),c._uU(2),c.Hsn(3),c.qZA(),c.TgZ(4,"input",2),c.NdJ("change",function(e){return t.onChange(e)}),c.qZA(),c.qZA()),2&e&&(c.Q6J("formGroup",t.parentForm),c.xp6(1),c.Q6J("ngStyle",t.style),c.uIk("for",t.controlName),c.xp6(1),c.hij("",t.labelValue," "),c.xp6(2),c.Q6J("multiple",t.multiple),c.uIk("id",t.controlName))},directives:[r.JL,r.sg,m.PC],styles:["[_ngcontent-%COMP%]:root{--game-size:400px}@media screen and (max-width: 800px){[_ngcontent-%COMP%]:root{--game-size:100%}}.regFile[_ngcontent-%COMP%], .regFile_label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.regFile_label[_ngcontent-%COMP%]{font-size:small;background-color:#4ecdc4;color:#fff;padding:10px;border:none;transition:.3s;font-weight:700;border-radius:5px;box-shadow:2px 2px 0 0 #47bdb5;cursor:pointer;width:100%}.regFile_label[_ngcontent-%COMP%]:hover{box-shadow:0 0 0 0;background-color:#47bdb5;color:#ffe66d}.regFile[_ngcontent-%COMP%]:focus{outline:0}.regFile_noInput[_ngcontent-%COMP%]{display:none}"]}),e})();var x=i(2481),_=i(9573);const T=[[["","background",""]],[["","card",""]]],w=function(e){return{sideMenu_displayed:e}},P=["[background]","[card]"];let C=(()=>{class e{constructor(e){this.document=e,this.display=!1}ngOnInit(){}ngOnChanges(e){[".root",".navBar"].forEach(e=>{this.document.querySelector(e).style.marginLeft=this.display?"150px":"0px"})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(m.K0))},e.\u0275cmp=c.Xpm({type:e,selectors:[["side-menu"]],inputs:{display:"display"},features:[c.TTD],ngContentSelectors:P,decls:9,vars:3,consts:[[1,"sideMenu",3,"ngClass"],[1,"sideMenu_transclude"]],template:function(e,t){1&e&&(c.F$t(T),c.TgZ(0,"div",0),c.TgZ(1,"p"),c._uU(2,"Dos de carte"),c.qZA(),c.TgZ(3,"div",1),c.Hsn(4,0,["class","sideMenu_transclude"]),c.qZA(),c.TgZ(5,"p"),c._uU(6,"Images selectionn\xe9es"),c.qZA(),c.TgZ(7,"div",1),c.Hsn(8,1),c.qZA(),c.qZA()),2&e&&c.Q6J("ngClass",c.VKq(1,w,t.display))},directives:[m.mk],styles:["[_ngcontent-%COMP%]:root{--game-size:400px}@media screen and (max-width: 800px){[_ngcontent-%COMP%]:root{--game-size:100%}}.sideMenu[_ngcontent-%COMP%]{width:0;position:absolute;top:0;left:0;background-color:#ffe66d;font-size:small;height:100%;overflow-y:scroll;overflow-x:hidden;transition:.2s ease;z-index:1}.sideMenu_transclude[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.sideMenu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Questrial,sans-serif;font-weight:700;width:100%;padding:10px 0;background-color:#4ecdc4;text-align:center}.sideMenu_displayed[_ngcontent-%COMP%]{border-right:2px solid #4ecdc4;width:150px}"]}),e})();var v=i(5741),b=i(3177);function Z(e,t){if(1&e){const e=c.EpF();c.ynx(0),c.TgZ(1,"reg-button",27),c.NdJ("click",function(){return c.CHM(e),c.oxw().displayCrop("cardBack")}),c._UZ(2,"i",28),c.qZA(),c.BQk()}2&e&&(c.xp6(1),c.Q6J("width",50))}function M(e,t){if(1&e){const e=c.EpF();c.ynx(0),c.TgZ(1,"reg-button",27),c.NdJ("click",function(){return c.CHM(e),c.oxw().displayCrop("pictures")}),c._UZ(2,"i",28),c.qZA(),c.BQk()}2&e&&(c.xp6(1),c.Q6J("width",50))}function y(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"reg-button",29),c.NdJ("click",function(){c.CHM(e);const t=c.oxw();return t.displaySideMenu=!t.displaySideMenu}),c._UZ(1,"i",30),c.qZA()}2&e&&c.Q6J("width",40)}function O(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"pictures-preview",33),c.NdJ("fileDelete",function(t){return c.CHM(e),c.oxw(2).pictureDelete(t,"cardBack")}),c.qZA()}if(2&e){const e=t.$implicit;c.Q6J("index",t.index)("picture",e)("size",100)}}function k(e,t){if(1&e&&(c.TgZ(0,"div",31),c.YNc(1,O,1,3,"pictures-preview",32),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.postThemeForm.value.cardBack)}}function F(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"pictures-preview",33),c.NdJ("fileDelete",function(t){return c.CHM(e),c.oxw(2).pictureDelete(t,"pictures")}),c.qZA()}if(2&e){const e=t.$implicit;c.Q6J("index",t.index)("picture",e)("size",100)}}function I(e,t){if(1&e&&(c.TgZ(0,"div",34),c.YNc(1,F,1,3,"pictures-preview",32),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.postThemeForm.value.pictures)}}const A=function(){return["sideMenu_button"]};let q=(()=>{class e{constructor(e,t,i,n,s,o,c){this.fb=e,this.alert=t,this.request=i,this.cropModal=n,this.routerHistory=s,this.router=o,this.searchModal=c,this.postThemeForm=this.fb.group({name:["",[r.kI.minLength(2),r.kI.required]],cardBack:[[],r.kI.required],pictures:[[],[r.kI.required,r.kI.minLength(10)]]}),this.buttonLabel="Valider",this.displaySideMenu=!1,this.pictureLengthTest=0,this.pictureLengthPreviousValue=0,this.pictureMinText=10,this.gotFiles={cardBack:0,pictures:0},this.isLoading=!1,this.searchModalSub=this.searchModal.userSelection$.subscribe()}ngOnInit(){this.pictureChangeHandler(),this.searchModalHandler()}ngOnDestroy(){this.postThemeForm.reset(),this.searchModalSub.unsubscribe()}pictureChangeHandler(){this.postThemeForm.valueChanges.pipe((0,s.U)(e=>{for(const t in this.gotFiles)e[t]&&(this.gotFiles[t]=e[t].length||0);return e.pictures}),(0,o.h)(e=>!!e&&(this.pictureMinText=this.computePictureMinText(),e.length!==this.pictureLengthPreviousValue&&(this.pictureLengthPreviousValue=e.length,e.length!==this.pictureLengthTest&&!0)))).subscribe(()=>{this.checkSame()})}displayCrop(e){this.cropModal.setInfo({props:{type:e,pictures:this.postThemeForm.value[e],opacity:.6,closeOnClick:!1,result:e=>this.postThemeForm.patchValue({[e.type]:e.payload})}})}checkSame(){const e=this.postThemeForm.value.pictures;if(!e)return;let t=[];t=e.map((e,t,i)=>{let n=0;return i.forEach(t=>{t.name===e.name&&n++}),n>1?"doublon":void 0}),t.includes("doublon")&&(this.alert.message=" Attention vous avez mis plusieurs fois la meme image",this.alert.switchAlert())}pictureDelete(e,t){const i=[...this.postThemeForm.value[t]].filter((t,i)=>i!==e);this.postThemeForm.patchValue({[t]:[...i]})}onSubmit(e){this.isLoading=!0,e.preventDefault();const{name:t,pictures:i,cardBack:n}=this.postThemeForm.value,r=new FormData;r.append("name",t),r.append("cardBack",n[0]),i.forEach(e=>{r.append("pictures",e)}),this.request.post("themes/",r).subscribe({next:e=>{this.isLoading=!1,this.alert.message="Theme correctement ajout\xe9",this.alert.switchAlert(),this.postThemeForm.reset(),this.goPreviousPage()},error:e=>{this.alert.message=e.error,this.alert.switchAlert()}})}goPreviousPage(){this.router.navigate([this.routerHistory.getPrevious()])}computePictureMinText(){const e=10-this.gotFiles.pictures;return e>=0?e:0}openGsearch(e){this.searchModal.setInfo({type:e,maxChoice:"cardBack"===e?1:0,opacity:.6,inputPlaceHolder:"Rechercher des Images"})}searchModalHandler(){this.searchModalSub=this.searchModal.userSelection$.subscribe(e=>{this.postThemeForm.patchValue({[e.type]:e.payload})})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.qu),c.Y36(a.c),c.Y36(d.s),c.Y36(l.O),c.Y36(h.H),c.Y36(n.F0),c.Y36(p.q))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-post-theme"]],decls:38,vars:28,consts:[[1,"postTheme"],[1,"postTheme_topTitle"],[1,"fas","fa-chevron-circle-left","fa-2x",3,"click"],[1,"postTheme_form"],[3,"formGroup","submit"],[1,"postTheme_titleInput"],["for","post_image",1,"postTheme_firstLabel"],[1,"postTheme_regComps"],["id","post_image",3,"parentForm","parentControlName","width","validate"],[1,"postTheme_inputPictures"],[1,"postTheme_picturesButtonsinputBox"],["for","post_cardBack_button"],[1,"postTheme_picturesButtonsClick"],["id","post_cardBack_button",3,"width","parentForm","controlName"],[3,"click"],[4,"ngIf"],["for","post_image_button"],["id","post_img_button",3,"width","parentForm","controlName","multiple","multiMax"],[1,"postTheme_vallidationEye"],["id","clickOutside_sideMenu_button",3,"width","click",4,"ngIf"],[1,"postTheme_validationSpinn"],[3,"size","isDisplayed"],[3,"type","label","disabled","width"],[1,"postTheme_preview"],["clickOutside","",3,"exceptions","display","clickOutside"],["background","",4,"ngIf"],["card","",4,"ngIf"],[3,"width","click"],[1,"fas","fa-crop-alt"],["id","clickOutside_sideMenu_button",3,"width","click"],[1,"fas","fa-eye"],["background",""],[3,"index","picture","size","fileDelete",4,"ngFor","ngForOf"],[3,"index","picture","size","fileDelete"],["card",""]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"i",2),c.NdJ("click",function(){return t.goPreviousPage()}),c.qZA(),c.TgZ(3,"h2"),c._uU(4,"Ajouter un theme"),c.qZA(),c.qZA(),c.TgZ(5,"div",3),c.TgZ(6,"form",4),c.NdJ("submit",function(e){return t.onSubmit(e)}),c.TgZ(7,"div",5),c.TgZ(8,"label",6),c._uU(9,"Entrez le nom du theme"),c.qZA(),c.TgZ(10,"div",7),c._UZ(11,"reg-input",8),c.qZA(),c.qZA(),c.TgZ(12,"div",9),c.TgZ(13,"div",10),c.TgZ(14,"label",11),c._uU(15,"Ajoutez un dos de carte"),c.qZA(),c.TgZ(16,"div",12),c._UZ(17,"reg-file",13),c.TgZ(18,"reg-button",14),c.NdJ("click",function(){return t.openGsearch("cardBack")}),c._uU(19," Rechercher "),c.qZA(),c.YNc(20,Z,3,1,"ng-container",15),c.qZA(),c.qZA(),c.TgZ(21,"div",10),c.TgZ(22,"label",16),c._uU(23),c.qZA(),c.TgZ(24,"div",12),c._UZ(25,"reg-file",17),c.TgZ(26,"reg-button",14),c.NdJ("click",function(){return t.openGsearch("pictures")}),c._uU(27," Rechercher "),c.qZA(),c.YNc(28,M,3,1,"ng-container",15),c.qZA(),c.qZA(),c.TgZ(29,"div",18),c.YNc(30,y,2,1,"reg-button",19),c.TgZ(31,"div",20),c._UZ(32,"reg-spinner",21),c._UZ(33,"reg-button",22),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c._UZ(34,"div",23),c.qZA(),c.TgZ(35,"side-menu",24),c.NdJ("clickOutside",function(){return t.displaySideMenu=!1}),c.YNc(36,k,2,1,"div",25),c.YNc(37,I,2,1,"div",26),c.qZA(),c.qZA()),2&e&&(c.xp6(6),c.Q6J("formGroup",t.postThemeForm),c.xp6(5),c.Q6J("parentForm",t.postThemeForm)("parentControlName","name")("width",200)("validate",t.postThemeForm.controls.name.valid),c.xp6(6),c.Q6J("width",130)("parentForm",t.postThemeForm)("controlName","cardBack"),c.xp6(3),c.Q6J("ngIf",t.gotFiles.cardBack>0),c.xp6(3),c.hij("Ajoutez au minimum ",t.pictureMinText," images pour creer un theme"),c.xp6(2),c.Q6J("width",130)("parentForm",t.postThemeForm)("controlName","pictures")("multiple",!0)("multiMax",100),c.xp6(3),c.Q6J("ngIf",t.gotFiles.pictures>0),c.xp6(2),c.Q6J("ngIf",t.gotFiles.cardBack>0||t.gotFiles.pictures>0),c.xp6(2),c.Q6J("size",20)("isDisplayed",t.isLoading),c.xp6(1),c.Q6J("type","submit")("label","Valider")("disabled",!t.postThemeForm.valid)("width",130),c.xp6(2),c.Q6J("exceptions",c.DdM(27,A))("display",t.displaySideMenu),c.xp6(1),c.Q6J("ngIf",t.gotFiles.cardBack>0),c.xp6(1),c.Q6J("ngIf",t.gotFiles.pictures>0))},directives:[r._Y,r.JL,r.sg,u.H,f,x.m,m.O5,_.q,C,v._,m.sg,b.V],styles:["[_ngcontent-%COMP%]:root{--game-size:400px}@media screen and (max-width: 800px){[_ngcontent-%COMP%]:root{--game-size:100%}}.postTheme[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.postTheme_firstLabel[_ngcontent-%COMP%]{color:#fff!important}.postTheme_topTitle[_ngcontent-%COMP%]{display:flex;width:90%;padding:10px;align-items:center}.postTheme[_ngcontent-%COMP%]   .fa-chevron-circle-left[_ngcontent-%COMP%]{color:#ffe66d;cursor:pointer;margin-right:10px}.postTheme_validationSpinn[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.postTheme[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#4ecdc4;font-size:small}.postTheme_titleInput[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;border-radius:5px;background-color:#4ecdc4;padding:10px;width:90%;align-items:center}.postTheme_titleInput[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:5px}.postTheme_regComps[_ngcontent-%COMP%]{display:flex}.postTheme_inputPictures[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;border-radius:5px;background-color:#ffe66d;padding:10px;width:90%}.postTheme[_ngcontent-%COMP%]   #clickOutside_sideMenu_button[_ngcontent-%COMP%]{margin-right:10px}.postTheme_picturesButtonsinputBox[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:10px}.postTheme_picturesButtonsinputBox[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:5px}.postTheme_preview[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.postTheme_preview[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:10px}.postTheme_picturesButtonsClick[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center}.postTheme_picturesButtonsClick[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:10px}.postTheme_vallidationEye[_ngcontent-%COMP%]{display:flex;justify-content:center}.postTheme_form[_ngcontent-%COMP%], .postTheme_form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.postTheme_form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:10px}"]}),e})();var B=i(1239),J=i(3025),N=i(9880),L=i(8891),z=i(9796),Q=i(9105);function S(e,t,i,n){return(0,Q.m)(i)&&(n=i,i=void 0),n?S(e,t,i).pipe((0,s.U)(e=>(0,z.k)(e)?n(...e):n(e))):new L.y(n=>{U(e,t,function(e){n.next(arguments.length>1?Array.prototype.slice.call(arguments):e)},n,i)})}function U(e,t,i,n,r){let s;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){const n=e;e.addEventListener(t,i,r),s=()=>n.removeEventListener(t,i,r)}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){const n=e;e.on(t,i),s=()=>n.off(t,i)}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){const n=e;e.addListener(t,i),s=()=>n.removeListener(t,i)}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(let s=0,o=e.length;s<o;s++)U(e[s],t,i,n,r)}n.add(s)}var D=i(3190),Y=i(2340);function H(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",18),c.TgZ(1,"reg-button",19),c.NdJ("click",function(){return c.CHM(e),c.oxw().displayCrop("cardBack")}),c._UZ(2,"i",20),c.qZA(),c.TgZ(3,"div",21),c._UZ(4,"reg-spinner",22),c.TgZ(5,"reg-button",19),c.NdJ("click",function(){return c.CHM(e),c.oxw().postNewCards("posted")}),c._uU(6,"Valider"),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=c.oxw();c.xp6(1),c.Q6J("width",50)("solo",!1),c.xp6(3),c.Q6J("size",20)("isDisplayed",e.isLoading.cardBack),c.xp6(1),c.Q6J("width",50)("solo",!1)}}function j(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",23),c.TgZ(1,"reg-button",24),c.NdJ("click",function(){return c.CHM(e),c.oxw().displayCrop("pictures")}),c._UZ(2,"i",20),c.qZA(),c.TgZ(3,"div",21),c._UZ(4,"reg-spinner",22),c.TgZ(5,"reg-button",24),c.NdJ("click",function(){return c.CHM(e),c.oxw().postNewCards("notPosted")}),c._uU(6,"Valider"),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=c.oxw();c.xp6(1),c.Q6J("width",50)("height",20),c.xp6(3),c.Q6J("size",20)("isDisplayed",e.isLoading.pictures),c.xp6(1),c.Q6J("width",100)("height",20)}}function V(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"pictures-preview",25),c.NdJ("fileDelete",function(){const t=c.CHM(e).$implicit;return c.oxw().deleteCard("posted",t.id)}),c._UZ(1,"reg-spinner",22),c.qZA()}if(2&e){const e=t.$implicit,i=t.index,n=c.oxw();c.Q6J("picture",e.file)("size",60)("index",i),c.xp6(1),c.Q6J("size",20)("isDisplayed",n.isLoading.deletePicture[e.id])}}function E(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"pictures-preview",26),c.NdJ("fileDelete",function(t){return c.CHM(e),c.oxw().deleteCard("notPosted",t)}),c._uU(1," plop "),c.qZA()}if(2&e){const e=t.index;c.Q6J("picture",t.$implicit)("size",60)("index",e)}}let $=(()=>{class e{constructor(e,t,i){this.cropModal=e,this.alert=t,this.request=i,this.theme={},this.themeIndex=0,this.onDelete=new c.vpe,this.cardBackStyle={},this.cardsPreview=[],this.cardsPreviewNotPosted=[],this.cardBackChange=!1,this.picturesChange=!1,this.isLoading={cardBack:!1,pictures:!1,deletePicture:[]}}ngOnInit(){this.getCardBack(),this.cardsPreview=this.getPreview(this.theme.images),this.formHandler()}formHandler(){this.cardBackFormHandler(),this.picturesFormHandler()}cardBackFormHandler(){this.themePutForm.valueChanges.pipe((0,s.U)(e=>e["cardBack"+this.themeIndex]),(0,o.h)(e=>e.length>0),(0,D.w)(e=>this.readData(e[0]))).subscribe(e=>{this.changeCardBackPreview(e),this.cardBackChange=!0})}picturesFormHandler(){this.themePutForm.valueChanges.pipe((0,s.U)(e=>e["pictures"+this.themeIndex]),(0,o.h)(e=>e.length>0)).subscribe(e=>{this.cardsPreviewNotPosted=[...e],this.picturesChange=!0})}getCardBack(){const e=this.theme.images.filter(e=>"cardBack"===e.type);0!==e.length&&this.changeCardBackPreview(Y.N.proxy+e[0].path)}getPreview(e){const t=[];return e.filter(e=>"themePic"===e.type).forEach(e=>{this.isLoading.deletePicture.push({[e.id]:!1}),t.push({file:Y.N.proxy+e.path,id:e._id})}),t}delete(){this.onDelete.emit(this.theme._id)}deleteCard(e,t){"notPosted"===e&&this.deleteNotPostedPrev(t),"posted"===e&&this.deletePostedCard(t)}deletePostedCard(e){if(this.cardsPreview.length<=10)return this.alert.message="Vous ne pouvez pas avoir moins de 10 cartes",void this.alert.switchAlert();this.isLoading.deletePicture[e]=!0,this.request.delete("uploads/"+this.theme._id+"/"+e).subscribe({next:t=>{this.cardsPreview=this.cardsPreview.filter(t=>t.id!==e),this.isLoading.deletePicture[e]=!1,this.alert.message="Carte correctement retir\xe9e",this.alert.switchAlert()},error:e=>{e.error&&(this.alert.message=e.error,this.alert.switchAlert())}})}deleteNotPostedPrev(e){this.cardsPreviewNotPosted=this.cardsPreviewNotPosted.filter((t,i)=>i!==e),this.themePutForm.patchValue({["pictures"+this.themeIndex]:this.cardsPreviewNotPosted})}changeCardBackPreview(e){this.cardBackStyle.backgroundImage=`url('${e}')`}readData(e){const t=new FileReader;return t.readAsDataURL(e),S(t,"load").pipe((0,s.U)(e=>e.target.result))}displayCrop(e){const t=e+this.themeIndex;this.cropModal.setInfo({props:{type:t,pictures:this.themePutForm.value[t],opacity:.6,closeOnClick:!1,result:e=>{const{payload:t}=e;this.themePutForm.patchValue({[(e.type==="cardBack"+this.themeIndex?"cardBack":"pictures")+this.themeIndex]:t})}}})}postNewCards(e){"notPosted"===e&&this.addNotPosted(),"posted"===e&&this.editPosted()}editPosted(){this.isLoading.cardBack=!0;const e=this.themePutForm.value["cardBack"+this.themeIndex],t=new FormData;t.append("cardBack",e[0]),this.request.put("themes/"+this.theme._id,t).subscribe({next:e=>{this.cardBackChange=!1,this.themePutForm.patchValue({["cardBack"+this.themeIndex]:[]}),this.isLoading.cardBack=!1},error:e=>{}})}addNotPosted(){this.isLoading.pictures=!0;const e=this.themePutForm.value["pictures"+this.themeIndex],t=new FormData;e.forEach(e=>{t.append("pictures",e)}),this.request.put("themes/"+this.theme._id,t).subscribe({next:e=>{this.cardsPreviewNotPosted=[],this.themePutForm.patchValue({["pictures"+this.themeIndex]:[]}),this.cardsPreview=this.getPreview(e.images),this.isLoading.pictures=!1},error:e=>{}})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(l.O),c.Y36(a.c),c.Y36(d.s))},e.\u0275cmp=c.Xpm({type:e,selectors:[["delete-theme-item"]],inputs:{theme:"theme",themePutForm:"themePutForm",themeIndex:"themeIndex"},outputs:{onDelete:"onDelete"},decls:24,vars:18,consts:[[1,"deleteThemeItem"],[1,"deleteThemeItem_bar"],[3,"width","height","danger","click"],[1,"deleteThemeItem_pictureContainer"],[1,"deleteThemeItem_cardBack"],[1,"deleteThemeItem_cardBackContainer"],[1,"deleteThemeItem_picture",3,"ngStyle"],[3,"formGroup"],["labelValue","Modifier le dos de carte",3,"parentForm","controlName","width"],["class","deleteThemeItem_cardBackModify",4,"ngIf"],[1,"deleteThemeItem_setPreview"],[1,"deleteThemeItem_cardTop"],["labelValue","","filesAddText","",3,"width","parentForm","controlName","multiple"],[1,"fas","fa-plus"],["class","deleteThemeItem_picturesButtons",4,"ngIf"],[1,"deleteThemeItem_previewSoloContainer"],["pictureType","path",3,"picture","size","index","fileDelete",4,"ngFor","ngForOf"],["pictureType","blob",3,"picture","size","index","fileDelete",4,"ngFor","ngForOf"],[1,"deleteThemeItem_cardBackModify"],[3,"width","solo","click"],[1,"fas","fa-crop-alt"],[1,"deleteThemeItem_validationSpinn"],[3,"size","isDisplayed"],[1,"deleteThemeItem_picturesButtons"],[3,"width","height","click"],["pictureType","path",3,"picture","size","index","fileDelete"],["pictureType","blob",3,"picture","size","index","fileDelete"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h2"),c._uU(3),c.qZA(),c.TgZ(4,"reg-button",2),c.NdJ("click",function(){return t.delete()}),c._uU(5,"supprimer"),c.qZA(),c.qZA(),c.TgZ(6,"div",3),c.TgZ(7,"div",4),c.TgZ(8,"div",5),c.TgZ(9,"div",6),c.TgZ(10,"form",7),c._UZ(11,"reg-file",8),c.qZA(),c.qZA(),c.YNc(12,H,7,6,"div",9),c.qZA(),c.qZA(),c.TgZ(13,"div",10),c.TgZ(14,"div",11),c.TgZ(15,"p"),c._uU(16,"Cartes"),c.qZA(),c.TgZ(17,"form",7),c.TgZ(18,"reg-file",12),c._UZ(19,"i",13),c.qZA(),c.qZA(),c.qZA(),c.YNc(20,j,7,6,"div",14),c.TgZ(21,"div",15),c.YNc(22,V,2,5,"pictures-preview",16),c.YNc(23,E,2,3,"pictures-preview",17),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(3),c.Oqu(t.theme.name),c.xp6(1),c.Q6J("width",140)("height",30)("danger",!0),c.xp6(5),c.Q6J("ngStyle",t.cardBackStyle),c.xp6(1),c.Q6J("formGroup",t.themePutForm),c.xp6(1),c.Q6J("parentForm",t.themePutForm)("controlName","cardBack"+t.themeIndex)("width",50),c.xp6(1),c.Q6J("ngIf",t.cardBackChange),c.xp6(5),c.Q6J("formGroup",t.themePutForm),c.xp6(1),c.Q6J("width",50)("parentForm",t.themePutForm)("controlName","pictures"+t.themeIndex)("multiple",!0),c.xp6(2),c.Q6J("ngIf",t.cardsPreviewNotPosted.length>0),c.xp6(2),c.Q6J("ngForOf",t.cardsPreview),c.xp6(1),c.Q6J("ngForOf",t.cardsPreviewNotPosted))},directives:[x.m,m.PC,r._Y,r.JL,r.sg,f,m.O5,m.sg,_.q,b.V],styles:["[_ngcontent-%COMP%]:root{--game-size:400px}@media screen and (max-width: 800px){[_ngcontent-%COMP%]:root{--game-size:100%}}.deleteThemeItem[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.deleteThemeItem[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#4ecdc4}.deleteThemeItem_validationSpinn[_ngcontent-%COMP%]{position:relative;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:flex;justify-content:center;align-items:center}.deleteThemeItem_bar[_ngcontent-%COMP%]{border-radius:5px;display:flex;justify-content:space-between;align-items:center;width:100%;z-index:2;background-color:#ffe66d;box-shadow:0 2px 0 0 #47bdb5}.deleteThemeItem_bar[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:10px}.deleteThemeItem_pictureContainer[_ngcontent-%COMP%]{margin-top:-5px;width:100%;display:flex;flex-direction:column;justify-content:space-between}.deleteThemeItem_picture[_ngcontent-%COMP%]{display:flex;align-items:flex-end;justify-content:flex-end;width:100px;height:100px;background-size:cover;border-radius:5px;box-shadow:2px 2px 0 0 #47bdb5;padding:5px}.deleteThemeItem_cardBack[_ngcontent-%COMP%]{z-index:1;background-color:#4ecdc4;padding:10px;display:flex}.deleteThemeItem_cardBackContainer[_ngcontent-%COMP%]{align-items:center;border-radius:5px}.deleteThemeItem_cardBackContainer[_ngcontent-%COMP%], .deleteThemeItem_picturesButtons[_ngcontent-%COMP%]{width:100%;background-color:#ffe66d;display:flex;justify-content:space-between}.deleteThemeItem_picturesButtons[_ngcontent-%COMP%]{border-radius:0 0 5px 5px}.deleteThemeItem_picturesButtons[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:10px}.deleteThemeItem_cardBackModify[_ngcontent-%COMP%]{height:100%;width:calc(100% - 80px);display:flex;flex-direction:column}.deleteThemeItem_cardBackModify[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:5px}.deleteThemeItem_previewSolo[_ngcontent-%COMP%]{position:relative;display:flex;width:60px;height:60px;margin:5px;background-size:cover;border-radius:5px;box-shadow:2px 2px 0 0 #47bdb5}.deleteThemeItem_setPreview[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:#4ecdc4;border-radius:0 0 5px 5px;padding:10px}.deleteThemeItem_previewSoloContainer[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;position:relative}.deleteThemeItem_cardTop[_ngcontent-%COMP%]{z-index:2;padding:5px;border-radius:5px;background-color:#ffe66d;box-shadow:0 2px 0 0 #47bdb5;display:flex;align-items:center;justify-content:space-between}.deleteThemeItem_cardTop[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#4ecdc4;font-size:small}"]}),e})();function G(e,t){if(1&e){const e=c.EpF();c._UZ(0,"reg-spinner",5),c.TgZ(1,"delete-theme-item",6),c.NdJ("onDelete",function(t){return c.CHM(e),c.oxw(2).delete(t)}),c.qZA()}if(2&e){const e=c.oxw(),t=e.$implicit,i=e.index,n=c.oxw();c.Q6J("size",50)("isDisplayed",n.isLoading),c.xp6(1),c.Q6J("theme",t)("themeIndex",i)("themePutForm",n.themesPutForm.controls["theme"+i])}}function X(e,t){1&e&&c.YNc(0,G,2,5,"ng-template",4)}let R=(()=>{class e{constructor(e,t,i,n,r){this.request=e,this.alert=t,this.fb=i,this.gameParams=n,this.bigSpinner=r,this.themeIndexChange=new c.vpe,this.themeLength=new c.vpe,this.userThemes=[],this.themesPutForm=this.fb.group({}),this.isLoading=!1}ngOnInit(){this.getThemes(),this.bigSpinner.show("getThemes")}onSwiper(e){this.themeIndexChange.emit(e.realIndex+1)}onSwiperStart(e){this.themeIndexChange.emit(e.realIndex+1)}delete(e){this.isLoading=!0,this.request.delete("themes/"+e).subscribe({next:e=>{this.userThemes=this.userThemes.filter(t=>t._id!==e._id),this.gameParams.setTheme({}),this.isLoading=!1,this.alert.message="Theme correctement supprim\xe9",this.alert.switchAlert()},error:e=>{this.alert.message=e.error,this.alert.switchAlert()}})}getThemes(){this.request.get("themes/all").subscribe({next:e=>{this.userThemes=e,this.themeLength.emit(e.length),this.createForms(e),this.bigSpinner.hide("getThemes")},error:e=>{console.log(e)}})}createForms(e){let t={};e.forEach((e,i)=>{t=Object.assign(Object.assign({},t),{["theme"+i]:this.fb.group({["cardBack"+i]:[[]],["pictures"+i]:[[]]})})}),this.themesPutForm=this.fb.group(t)}trackByFn(e,t){return t._id}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(d.s),c.Y36(a.c),c.Y36(r.qu),c.Y36(B.t),c.Y36(J.L))},e.\u0275cmp=c.Xpm({type:e,selectors:[["delete-theme"]],inputs:{themeIndex:"themeIndex"},outputs:{themeIndexChange:"themeIndexChange",themeLength:"themeLength"},decls:4,vars:5,consts:[[1,"deleteTheme"],[1,"deleteTheme_container"],[3,"slidesPerView","spaceBetween","roundLengths","swiper","slideChange"],[4,"ngFor","ngForOf","ngForTrackBy"],["swiperSlide",""],[3,"size","isDisplayed"],[1,"deleteTheme_itemContainer",3,"theme","themeIndex","themePutForm","onDelete"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"swiper",2),c.NdJ("swiper",function(e){return t.onSwiperStart(e)})("slideChange",function(e){return t.onSwiper(e)}),c.YNc(3,X,1,0,void 0,3),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(2),c.Q6J("slidesPerView",1)("spaceBetween",10)("roundLengths",!0),c.xp6(1),c.Q6J("ngForOf",t.userThemes)("ngForTrackBy",t.trackByFn))},directives:[N.nF,m.sg,N.YC,_.q,$],styles:["[_ngcontent-%COMP%]:root{--game-size:400px}@media screen and (max-width: 800px){[_ngcontent-%COMP%]:root{--game-size:100%}}.deleteTheme[_ngcontent-%COMP%]{flex-direction:column;align-items:center;display:flex}.deleteTheme_container[_ngcontent-%COMP%]{align-items:center;height:100%;margin-bottom:75px;position:relative}.deleteTheme_container[_ngcontent-%COMP%], .deleteTheme_itemContainer[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center}.deleteTheme[_ngcontent-%COMP%]   .swiper-container[_ngcontent-%COMP%]{width:90%}"]}),e})();function K(e,t){if(1&e&&(c.TgZ(0,"div",5),c.TgZ(1,"p"),c._uU(2),c.qZA(),c.qZA()),2&e){const e=c.oxw();c.xp6(2),c.AsE("",e.themePosition," / ",e.themeSize,"")}}function W(e,t){if(1&e&&(c.TgZ(0,"reg-button",6),c.TgZ(1,"div",7),c._uU(2),c._UZ(3,"i",8),c.qZA(),c.qZA()),2&e){const e=t.$implicit;c.Q6J("height",30)("width",150)("routerLink",e.link),c.xp6(2),c.hij(" ",e.value," ")}}const ee=[{path:"",component:(()=>{class e{constructor(e){this.cdref=e,this.themesCrud=[{value:"Ajouter un theme",link:["/user/profile/themes/post"]}],this.themeSize=0}forceIndexChange(e){this.themePosition=e,this.cdref.detectChanges()}getThemeLength(e){this.themeSize=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(c.sBO))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-theme-landing"]],decls:7,vars:3,consts:[[1,"themeLanding"],[1,"themeLanding_wrapper"],["class","themeLanding_number",4,"ngIf"],[3,"height","width","routerLink",4,"ngFor","ngForOf"],[3,"themeIndex","themeIndexChange","themeLength"],[1,"themeLanding_number"],[3,"height","width","routerLink"],[1,"themeLanding_addButton"],[1,"fas","fa-plus"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"h2"),c._uU(2,"Mes Themes"),c.qZA(),c.TgZ(3,"div",1),c.YNc(4,K,3,2,"div",2),c.YNc(5,W,4,4,"reg-button",3),c.qZA(),c.TgZ(6,"delete-theme",4),c.NdJ("themeIndexChange",function(e){return t.forceIndexChange(e)})("themeLength",function(e){return t.getThemeLength(e)}),c.qZA(),c.qZA()),2&e&&(c.xp6(4),c.Q6J("ngIf",t.themeSize>0),c.xp6(1),c.Q6J("ngForOf",t.themesCrud),c.xp6(1),c.Q6J("themeIndex",t.themePosition))},directives:[m.O5,m.sg,R,x.m,n.rH],styles:["[_ngcontent-%COMP%]:root{--game-size:400px}@media screen and (max-width: 800px){[_ngcontent-%COMP%]:root{--game-size:100%}}.themeLanding[_ngcontent-%COMP%]{display:flex;flex-direction:column}.themeLanding[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{align-self:center;margin-bottom:10px}.themeLanding_wrapper[_ngcontent-%COMP%]{align-self:center;display:flex;justify-content:space-between;align-items:center;width:90%}.themeLanding_wrapper[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:10px}.themeLanding_wrapper[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:700;color:#4ecdc4;display:flex;align-items:center;justify-content:center}.themeLanding_addButton[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:5px}.themeLanding_number[_ngcontent-%COMP%]{background-color:#ffe66d;height:30px;border-radius:5px;display:flex;align-items:center;justify-content:center;width:50px}"]}),e})()},{path:"post",component:q}];let te=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[n.Bz.forChild(ee)],n.Bz]}),e})();var ie=i(6684);let ne=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[te,ie.m,N.kz]]}),e})()}}]);